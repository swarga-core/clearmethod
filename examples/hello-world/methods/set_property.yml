method:
  name: set_property
  concept: HELLO_TASK
  implements: TASK.set_property
  version: "0.1.0"
  description: "Устанавливает значение указанного свойства задачи в YAML файле"

parameters:
  - name: task_id
    type: string
    required: true
    description: "Уникальный идентификатор задачи"
  
  - name: name
    type: string
    required: true
    description: "Имя свойства"
  
  - name: value
    type: any
    required: true
    description: "Значение свойства"

preconditions:
  - validate: exists(".cm/tasks/{task_id}.yml")
    error: "Файл задачи {task_id}.yml не найден"

execute:
  - read: ".cm/tasks/{task_id}.yml"
    as: yaml
    into: task_data
  
  - let: task_data.properties[name] = value
  - let: task_data.last_updated_at = current_datetime()
  
  - write: "{task_data}"
    as: yaml
    to: ".cm/tasks/{task_id}.yml"
  
  - info: "Property '{name}' of task {task_id} set to '{value}'"

postconditions:
  - read: ".cm/tasks/{task_id}.yml"
    as: yaml
    into: updated_data
  - validate: updated_data.properties[name] == value
    error: "Свойство '{name}' задачи {task_id} не было обновлено"

on_error:
  - error: "Не удалось установить свойство '{name}' для задачи {task_id}"

