# State: Finish
# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ - –ø–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤

state:
  status: finish
  title: "Finish"
  description: "–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –ø–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ —Ç–µ—Å—Ç–æ–≤"

preconditions:
  - description: "Process –∑–∞–≤–µ—Ä—à–µ–Ω"
    check: "TASK.get_property(task_id, 'process_complete') == true"

execute:
  # 1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
  - info: "üèÅ Finish state - wrapping up"
  
  # 2. –û–±–Ω–æ–≤–∏—Ç—å stage
  - TASK.set_property(task_id, "stage", "finish")
  
  # 3. –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  - group: "Collect test results"
    do:
      - let: start_done = TASK.get_property(task_id, "start_complete")
      - let: process_done = TASK.get_property(task_id, "process_complete")
      - let: conditional_test = TASK.get_property(task_id, "conditional_test")
      
      - info: "Test Results:"
      - info: "- Start complete: {start_done}"
      - info: "- Process complete: {process_done}"
      - info: "- Conditional test: {conditional_test}"
  
  # 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥
  - group: "Verify logging"
    do:
      - let: task_log = TASK.get_log(task_id)
      - let: log_entries = length(task_log)
      - info: "Total log entries: {log_entries}"
      
      - validate: log_entries > 0
        error: "Log should contain entries"
  
  # 5. –§–∏–Ω–∞–ª—å–Ω—ã–π –ª–æ–≥
  - TASK.log(task_id, "Finish state: test workflow completed successfully")
  
  # 6. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  - TASK.set_property(task_id, "workflow_complete", true)
  - TASK.set_property(task_id, "final_status", "success")
  
  # 7. –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
  - info: "üéâ Test workflow completed successfully!"
  - info: "Task {task_id} finished"
  - info: ""
  - info: "All ClearMethod mechanics tested:"
  - info: "  ‚úì Variables (let:)"
  - info: "  ‚úì Conditionals (if/then/else)"
  - info: "  ‚úì Loops (for, while)"
  - info: "  ‚úì Groups (group: + do:)"
  - info: "  ‚úì Concept methods (TASK.*)"
  - info: "  ‚úì Properties (get/set)"
  - info: "  ‚úì Logging"
  - info: "  ‚úì String interpolation"
  - info: "  ‚úì Validation"
  - info: "  ‚úì User interaction (ask)"
  - info: ""
  - info: "Check task file: .cm/tasks/{task_id}.yml"

postconditions:
  - description: "Workflow –∑–∞–≤–µ—Ä—à–µ–Ω"
    check: "TASK.get_property(task_id, 'workflow_complete') == true"
  
  - description: "–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    check: "TASK.get_property(task_id, 'final_status') == 'success'"

next_states: []  # –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

agent_notes: |
  –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ workflow.
  
  –ó–¥–µ—Å—å –º—ã:
  - –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
  - –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥
  - –ü–æ–¥–≤–æ–¥–∏–º –∏—Ç–æ–≥–∏
  - –û—Ç–º–µ—á–∞–µ–º –∑–∞–¥–∞—á—É –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é
  
  –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è workflow —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º.
  –ú–æ–∂–Ω–æ –∏–∑—É—á–∏—Ç—å —Ñ–∞–π–ª .cm/tasks/{task_id}.yml —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å
  –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Å–¥–µ–ª–∞–Ω—ã –≤ —Ö–æ–¥–µ workflow.

