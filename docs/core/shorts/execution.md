# Как работает ClearMethod пошагово

Рассмотрим на примере workflow `fetaure` из расширения `fsd`

Все начинается с команды в чате. Пользователь вводит команду:

`\cm start vsd.feature AL-123`
или сокращенно:
`\cm start feature AL-123`

Агент выполняет следующие действия:

- Имея в первоначально загруженном контексте информацию о метакоманде `\cm`, агент находит файл с командой и начинает читать его (либо, если речь идет о cursor - он сразу же начинает чтение файла из особой папки). Метакоманда `\cm` рассказывает ему о своем формате - о первом параметре, который представляет собой непосредственно команду, которую необходимо прочитать.
- Агент, зная из контекста, где искать все команды, находит одноименный файл в папке `commands` и начинает его читать.
- Файл `start.md` сообщает ему, что нужно обратить внимание на следующие за командой параметры, которые определяют <extension_id.workflow_id> - id расширения и рабочего процесса и <task_id> - id будущей задачи. Если параметры отсутствуют, агенту предписано уточнить их у пользователя.
- Также эта команда предписывает агенту найти файл с определенным ранее <extension_id.workflow_id>. Он лежит в папке `workflows` и является yaml-файлом, описывающим рабочий процесс (Если используется сокращенный вариант команды, без расширения, используется поиск по конфигу с расширениями). Итак, для нашего случая это рабочий процесс `workflows/fsd/feature`
- Из предварительного контекста агент знает, что это - конфигурационный файл рабочего процесса. Задача агента - узнать из него id начального состояния и найти файл этого состояния. В нашем случае это `CREATING`. Заранее зная, где искать, агент находит файл `creating.yml` в папке `nodes`.
- Агент находит предусловия вхождения в состояние, читает их и начинает проверять. Если они не выполнены, сообщает об этом пользователю, и ожидает его решений. Если выполнены, запускает событие `START_TASK` и выполняет инструкции всех подписанных на него подписчиков. Работа с событиями описана в отдельном документе, чтобы не усложнять текущее общее описание работы над процессом.
- После этого агент находит файл `start.exec.yml` или `start.exec.script` (в зависимости от типа, указанного в файле состояния) и, используя свои знания об инструкциях ClearMethod, полученные в прайминге, начинает пошаговое выполнение инструкций, содержащихся в нем.
