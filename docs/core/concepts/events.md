# –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π ClearMethod

> **–°–æ–±—ã—Ç–∏–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è —Å–ª–∞–±–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤**

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ö–æ–Ω—Ü–µ–ø—Ç EVENT](#–∫–æ–Ω—Ü–µ–ø—Ç-event)
4. [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è BASIC_EVENT](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-basic_event)
5. [–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π](#—Ç–∏–ø—ã-—Å–æ–±—ã—Ç–∏–π)
6. [–†–∞–±–æ—Ç–∞ —Å —Å–æ–±—ã—Ç–∏—è–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å-—Å–æ–±—ã—Ç–∏—è–º–∏)
7. [–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π](#–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏-—Å–æ–±—ã—Ç–∏–π)
8. [–ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã](#–ø–æ–¥–ø–∏—Å–∫–∏-–∏-—Ñ–∏–ª—å—Ç—Ä—ã)
9. [–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è](#–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
10. [–ö–∞—Å–∫–∞–¥—ã —Å–æ–±—ã—Ç–∏–π](#–∫–∞—Å–∫–∞–¥—ã-—Å–æ–±—ã—Ç–∏–π)
11. [–û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–æ—Ç–ª–∞–¥–∫–∞-–∏-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
12. [Best Practices](#best-practices)
13. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Å–æ–±—ã—Ç–∏—è?

**–ü—Ä–æ–±–ª–µ–º–∞**: –í —Å–ª–æ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–∞–∫–µ—Ç–æ–≤ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- `sbd` workflow —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã `git-vcs` —Å–æ–∑–¥–∞–ª –≤–µ—Ç–∫—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏
- `qa-gates` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç–∞–¥–∏—é
- `notifications` –Ω—É–∂–Ω–æ —É–≤–µ–¥–æ–º–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏

**–ü–ª–æ—Ö–æ–µ —Ä–µ—à–µ–Ω–∏–µ**: –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã
```yaml
# ‚ùå –ñ–µ—Å—Ç–∫–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å
- VCS.create_branch(...)  # workflow –∑–∞–≤–∏—Å–∏—Ç –æ—Ç git-vcs
- QA.check_quality(...)   # workflow –∑–∞–≤–∏—Å–∏—Ç –æ—Ç qa-gates
- NOTIFY.send_slack(...)  # workflow –∑–∞–≤–∏—Å–∏—Ç –æ—Ç notifications
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
- Workflow –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–∞–∫–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è workflow
- –°–ª–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

**–•–æ—Ä–æ—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ**: –°–æ–±—ã—Ç–∏—è
```yaml
# ‚úÖ –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å
- EVENT.emit("task.created", {task_id: "FEAT-001"})

# –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ:
# git-vcs ‚Üí on_task_created ‚Üí —Å–æ–∑–¥–∞–µ—Ç –≤–µ—Ç–∫—É
# qa-gates ‚Üí on_task_created ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç checklist
# notifications ‚Üí on_task_created ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- Workflow –Ω–µ –∑–Ω–∞–µ—Ç –æ –ø–∞–∫–µ—Ç–∞—Ö
- –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è workflow
- –ö–∞–∂–¥–æ–µ –ø–∞–∫–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Å–æ–±—ã—Ç–∏–π

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. EVENT EMITTER (–∏—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–±—ã—Ç–∏—è)                ‚îÇ
‚îÇ    - Workflow states                                ‚îÇ
‚îÇ    - –ú–µ—Ç–æ–¥—ã –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤                               ‚îÇ
‚îÇ    - –ö–æ–º–∞–Ω–¥—ã                                        ‚îÇ
‚îÇ    - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (cascade)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. EVENT DISPATCHER (–¥–∏—Å–ø–µ—Ç—á–µ—Ä)                     ‚îÇ
‚îÇ    - –†–µ–∑–æ–ª–≤–∏–Ω–≥ EVENT ‚Üí BASIC_EVENT                  ‚îÇ
‚îÇ    - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –ª–æ–≥                       ‚îÇ
‚îÇ    - –ü–æ–∏—Å–∫ –ø–æ–¥–ø–∏—Å–æ–∫                                 ‚îÇ
‚îÇ    - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº                  ‚ñº            ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇHandler 1‚îÇ      ‚îÇHandler 2‚îÇ  ‚îÇHandler 3‚îÇ    ‚îÇHandler N‚îÇ
‚îÇPriority ‚îÇ      ‚îÇPriority ‚îÇ  ‚îÇPriority ‚îÇ    ‚îÇPriority ‚îÇ
‚îÇ   10    ‚îÇ      ‚îÇ   20    ‚îÇ  ‚îÇ   50    ‚îÇ    ‚îÇ  100    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ                ‚îÇ           ‚îÇ               ‚îÇ
     ‚ñº                ‚ñº           ‚ñº               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. –†–ï–ó–£–õ–¨–¢–ê–¢–´                                       ‚îÇ
‚îÇ    - –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞          ‚îÇ
‚îÇ    - –õ–æ–≥–∏ –∏ –æ—à–∏–±–∫–∏                                  ‚îÇ
‚îÇ    - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è                               ‚îÇ
‚îÇ    - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –ª–æ–≥–µ                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```yaml
1. –≠–º–∏—Å—Å–∏—è —Å–æ–±—ã—Ç–∏—è
   EVENT.emit("task.created", {task_id: "FEAT-001"})
   
2. –†–µ–∑–æ–ª–≤–∏–Ω–≥
   EVENT ‚Üí project.yml ‚Üí basic-events.BASIC_EVENT
   
3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
   event_id: evt-001
   type: task.created
   payload: {task_id: "FEAT-001"}
   
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–æ–≥
   .cm/events/events.yml ‚Üê append event
   
5. –ü–æ–∏—Å–∫ –ø–æ–¥–ø–∏—Å–æ–∫
   .cm/events/subscriptions.yml ‚Üí read
   filter by: event_type == "task.created"
   
6. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
   subscription.filter matches payload?
   
7. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ priority
   [sub1(p:10), sub2(p:20), sub3(p:50)]
   
8. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–≤ –ø–æ—Ä—è–¥–∫–µ priority)
   for each subscription:
     read handler.yml
     execute with context: {event, payload}
     log result (success/error)
   
9. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
   event.handlers_executed = [...]
   event.duration_ms = 1234
   event.status = "completed"
```

---

## –ö–æ–Ω—Ü–µ–ø—Ç EVENT

### –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

`EVENT` - —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–æ–Ω—Ü–µ–ø—Ç, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –≤ `core/concepts/event.yml`.

**–¢–∏–ø**: abstract (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

**–ú–µ—Ç–æ–¥—ã**:

#### emit()
–≠–º–∏—Ç–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.

```yaml
params:
  - event_type: string      # "task.created", "workflow.stage_completed"
  - payload: object         # –î–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
  - sync: boolean           # –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ (true) –∏–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ (default: true)

returns:
  - event_id: string        # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–±—ã—Ç–∏—è
  - handlers_executed: number  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
  - duration_ms: number     # –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```

#### subscribe()
–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è.

```yaml
params:
  - event_type: string      # –¢–∏–ø —Å–æ–±—ã—Ç–∏—è –∏–ª–∏ wildcard "task.*"
  - extension: string       # –ò–º—è –ø–∞–∫–µ—Ç–∞
  - handler: string         # –ü—É—Ç—å –∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É
  - filter: object          # –£—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (optional)
  - priority: number        # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1-200+, default: 100)
  - enabled: boolean        # –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ (default: true)

returns:
  - subscription_id: string # ID –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è unsubscribe
```

#### unsubscribe()
–£–¥–∞–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É.

```yaml
params:
  - subscription_id: string

returns:
  - success: boolean
```

#### get_history()
–ü–æ–ª—É—á–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–±—ã—Ç–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

```yaml
params:
  - task_id: string         # –§–∏–ª—å—Ç—Ä –ø–æ –∑–∞–¥–∞—á–µ (optional)
  - event_type: string      # –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É (optional)
  - limit: number           # –ú–∞–∫—Å. —Å–æ–±—ã—Ç–∏–π (default: 50)
  - since: string           # –° –∫–∞–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (ISO 8601, optional)

returns:
  - events: array           # –ú–∞—Å—Å–∏–≤ —Å–æ–±—ã—Ç–∏–π (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–µ)
```

#### list_subscriptions()
–°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫.

```yaml
params:
  - event_type: string      # –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É (optional)
  - extension: string       # –§–∏–ª—å—Ç—Ä –ø–æ –ø–∞–∫–µ—Ç—É (optional)
  - enabled_only: boolean   # –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (default: true)

returns:
  - subscriptions: array    # –ú–∞—Å—Å–∏–≤ –ø–æ–¥–ø–∏—Å–æ–∫
```

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è BASIC_EVENT

### –§–∞–π–ª–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

`BASIC_EVENT` - –±–∞–∑–æ–≤–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ü–µ–ø—Ç–∞ `EVENT`.

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `packages/basic-events/`

**–¢–∏–ø**: concrete (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

**Implements**: EVENT

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã** - –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (1-200+)
‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - —É—Å–ª–æ–≤–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –∫–∞—Å–∫–∞–¥–∞ 10 —É—Ä–æ–≤–Ω–µ–π
‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫** - —Å–±–æ–π –æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥—Ä—É–≥–∏–µ
‚úÖ **–ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç** - –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
‚úÖ **–§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ë–î

### –•—Ä–∞–Ω–∏–ª–∏—â–µ

```
.cm/events/
‚îú‚îÄ‚îÄ events.yml          # –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ª–æ–≥ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
‚îî‚îÄ‚îÄ subscriptions.yml   # –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
```

#### –§–æ—Ä–º–∞—Ç —Å–æ–±—ã—Ç–∏—è

```yaml
# .cm/events/events.yml
- id: evt-001
  type: task.created
  timestamp: 2025-11-25T10:30:00Z
  payload:
    task_id: FEAT-001
    workflow: sbd.feature
    title: "Add user authentication"
    created_by: "John Doe"
  cascade_depth: 0
  handlers_executed:
    - subscription_id: sub-001
      extension: git-vcs
      handler: handlers/on_task_created
      status: success
      duration_ms: 156
    - subscription_id: sub-002
      extension: qa-gates
      handler: handlers/validate_preconditions
      status: success
      duration_ms: 89
  duration_ms: 245
  status: completed
```

#### –§–æ—Ä–º–∞—Ç –ø–æ–¥–ø–∏—Å–∫–∏

```yaml
# .cm/events/subscriptions.yml
subscriptions:
  - id: sub-001
    event_type: task.created
    extension: git-vcs
    handler: handlers/on_task_created
    filter:
      workflow: sbd.feature
    priority: 20
    enabled: true
    created_at: 2025-11-25T09:00:00Z
```

---

## –¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–∏–ø—ã

ClearMethod –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –Ω–∞–±–æ—Ä —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤.

#### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á–∏

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ —ç–º–∏—Ç–∏—Ç—Å—è | Payload |
|---------|---------------|---------|
| `task.created` | –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞ | task_id, workflow, title, created_by |
| `task.updated` | –°–≤–æ–π—Å—Ç–≤–∞ –∑–∞–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã | task_id, changes |
| `task.deleted` | –ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞ | task_id |
| `task.property_changed` | –û–¥–Ω–æ —Å–≤–æ–π—Å—Ç–≤–æ –∏–∑–º–µ–Ω–µ–Ω–æ | task_id, property, old_value, new_value |
| `task.state_changed` | Workflow —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–æ | task_id, from, to |
| `task.stage_started` | –ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–∞–¥–∏–∏ | task_id, stage |
| `task.stage_completed` | –°—Ç–∞–¥–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ | task_id, stage, duration_ms |
| `task.workflow_started` | Workflow –∑–∞–ø—É—â–µ–Ω | task_id, workflow |
| `task.workflow_completed` | Workflow –∑–∞–≤–µ—Ä—à–µ–Ω | task_id, workflow, final_state, duration_ms |
| `task.workflow_failed` | Workflow –ø—Ä–æ–≤–∞–ª–µ–Ω | task_id, workflow, error |

#### –ö–∞—á–µ—Å—Ç–≤–æ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ —ç–º–∏—Ç–∏—Ç—Å—è | Payload |
|---------|---------------|---------|
| `quality.gate_checked` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ | task_id, gate_name, stage |
| `quality.gate_passed` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞ | task_id, gate_name, checks |
| `quality.gate_failed` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–∞ | task_id, gate_name, errors |
| `validation.precondition_checked` | Precondition –ø—Ä–æ–≤–µ—Ä–µ–Ω | task_id, stage, result |
| `validation.postcondition_checked` | Postcondition –ø—Ä–æ–≤–µ—Ä–µ–Ω | task_id, stage, result |
| `validation.reality_check_triggered` | Reality check –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω | task_id, check_name, reason |

#### VCS –æ–ø–µ—Ä–∞—Ü–∏–∏

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ —ç–º–∏—Ç–∏—Ç—Å—è | Payload |
|---------|---------------|---------|
| `vcs.branch_created` | –í–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ | task_id, branch, from_branch |
| `vcs.commit_created` | –ö–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–Ω | task_id, sha, message, files |
| `vcs.push_completed` | Push –≤—ã–ø–æ–ª–Ω–µ–Ω | task_id, branch, commits_count |
| `vcs.pr_created` | Pull Request —Å–æ–∑–¥–∞–Ω | task_id, pr_url, pr_number, title |
| `vcs.pr_merged` | PR —Å–ª–∏—Ç | task_id, pr_number, merged_by |

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ —ç–º–∏—Ç–∏—Ç—Å—è | Payload |
|---------|---------------|---------|
| `context.loaded` | –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω | files_count, tokens_used |
| `context.updated` | –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω | added_files, removed_files |
| `context.file_added` | –§–∞–π–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç | file_path, size_bytes |
| `context.optimized` | –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω | old_tokens, new_tokens |

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ —ç–º–∏—Ç–∏—Ç—Å—è | Payload |
|---------|---------------|---------|
| `extension.registered` | –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ | extension_name, version |
| `command.executed` | –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ | command_name, params, duration_ms |
| `error.occurred` | –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ | error_type, message, stack_trace |

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

**–§–æ—Ä–º–∞—Ç**: `{domain}.{action}_{past_tense}`

**–ü—Ä–∏–º–µ—Ä—ã**:
- ‚úÖ `task.created` - –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ `workflow.stage_completed` - —Å—Ç–∞–¥–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- ‚úÖ `vcs.branch_created` - –≤–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
- ‚ùå `task.create` - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–µ past tense)
- ‚ùå `TaskCreated` - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–µ kebab-case)

**–î–æ–º–µ–Ω—ã**:
- `task` - —Å–æ–±—ã—Ç–∏—è –∑–∞–¥–∞—á–∏
- `workflow` - —Å–æ–±—ã—Ç–∏—è workflow
- `quality` - –∫–∞—á–µ—Å—Ç–≤–æ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- `vcs` - version control
- `context` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- `system` - —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- `{extension}` - –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ø–∞–∫–µ—Ç–æ–≤

---

## –†–∞–±–æ—Ç–∞ —Å —Å–æ–±—ã—Ç–∏—è–º–∏

### –≠–º–∏—Å—Å–∏—è —Å–æ–±—ã—Ç–∏—è –≤ CML

```yaml
# –ë–∞–∑–æ–≤—ã–π –≤—ã–∑–æ–≤
- EVENT.emit("task.created", {
    task_id: "FEAT-001",
    workflow: "sbd.feature",
    title: "Add authentication"
  })

# –° –∑–∞—Ö–≤–∞—Ç–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- let: result = EVENT.emit("task.stage_completed", {
    task_id: "FEAT-001",
    stage: "designing"
  })
- info: "Event {result.event_id} triggered {result.handlers_executed} handlers in {result.duration_ms}ms"

# –í —É—Å–ª–æ–≤–Ω—ã—Ö –±–ª–æ–∫–∞—Ö
- if: validation_passed
  then:
    - EVENT.emit("quality.gate_passed", {
        task_id: task_id,
        gate_name: "design_review"
      })
  else:
    - EVENT.emit("quality.gate_failed", {
        task_id: task_id,
        gate_name: "design_review",
        errors: validation_errors
      })

# –í —Ü–∏–∫–ª–∞—Ö
- for: file in changed_files
  do:
    - EVENT.emit("vcs.file_modified", {
        task_id: task_id,
        file_path: file
      })
```

### –ì–¥–µ —ç–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è

‚úÖ **–í workflow states** - –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
```yaml
# states/creating.yml
instructions:
  - EVENT.emit("task.stage_started", {stage: "creating"})
  # ... –ª–æ–≥–∏–∫–∞ ...
  - EVENT.emit("task.stage_completed", {stage: "creating"})
```

‚úÖ **–í –º–µ—Ç–æ–¥–∞—Ö –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤** - –≤–∞–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```yaml
# file-task/methods/create.yml
instructions:
  # ... —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ ...
  - EVENT.emit("task.created", {task_id: task_id})
```

‚úÖ **–í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö** - –∫–∞—Å–∫–∞–¥—ã
```yaml
# git-vcs/handlers/on_task_created.yml
instructions:
  - VCS.create_branch(...)
  - EVENT.emit("vcs.branch_created", {...})
```

‚ùå **–ù–µ —ç–º–∏—Ç–∏—Ä—É–π—Ç–µ –≤**:
- –¢—Ä–∏–≤–∏–∞–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö (get_property)
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —à–∞–≥–∞—Ö –ª–æ–≥–∏–∫–∏
- –¶–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö (—Ä–∏—Å–∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –∫–∞—Å–∫–∞–¥–∞)

---

## –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ - —ç—Ç–æ CML —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏.

**–ü—É—Ç—å**: `.cm/packages/{extension}/handlers/{handler_name}.yml`

**–§–æ—Ä–º–∞—Ç**:
```yaml
name: handler_name
description: What this handler does

params:
  - name: event      # –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å–æ–±—ã—Ç–∏—è
    type: object
    description: Event object with id, type, timestamp, payload
  
  - name: payload    # –î–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (shortcut)
    type: object
    description: Event payload data

instructions:
  - info: "Handling {event.type} for task {payload.task_id}"
  
  # Validate preconditions
  - if: !payload.task_id
    then:
      - warn: "No task_id in payload, skipping"
      - return
  
  # Your logic here
  - let: task = TASK.get(payload.task_id)
  - let: branch_name = "feature/{task.id}-{slugify(task.title)}"
  
  # Perform action
  - VCS.create_branch(task.id, branch_name)
  
  # Log action
  - TASK.log(task.id, "Git branch created: {branch_name}")
  
  # Can emit new events (cascade)
  - EVENT.emit("vcs.branch_created", {
      task_id: task.id,
      branch: branch_name,
      triggered_by: event.id
    })
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

#### event (object)
–ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å–æ–±—ã—Ç–∏—è:
```yaml
event:
  id: "evt-001"
  type: "task.created"
  timestamp: "2025-11-25T10:30:00Z"
  payload: {...}
  cascade_depth: 0
```

#### payload (object)
–î–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞):
```yaml
payload:
  task_id: "FEAT-001"
  workflow: "sbd.feature"
  title: "Add authentication"
```

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:
- –ò–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ `event` –∏ `payload`
- –ú–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –∫–æ–Ω—Ü–µ–ø—Ç–æ–≤ (TASK, VCS, QA_GATE –∏ —Ç.–¥.)
- –ú–æ–∂–µ—Ç —ç–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
- **–ù–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º workflow** (–∏–∑–æ–ª—è—Ü–∏—è!)

---

## –ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

#### –í—Ä—É—á–Ω—É—é (–≤ subscriptions.yml)

```yaml
# .cm/events/subscriptions.yml
subscriptions:
  - id: sub-git-001
    event_type: task.created
    extension: git-vcs
    handler: handlers/on_task_created
    filter:
      workflow: sbd.feature
    priority: 20
    enabled: true
```

#### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ (–≤ CML)

```yaml
# –í setup —Å–∫—Ä–∏–ø—Ç–µ –ø–∞–∫–µ—Ç–∞
- let: sub_id = EVENT.subscribe(
    "task.created",
    "git-vcs",
    "handlers/on_task_created",
    {
      filter: {workflow: "sbd.feature"},
      priority: 20
    }
  )
- info: "Subscribed with ID: {sub_id}"
```

### –§–∏–ª—å—Ç—Ä—ã

–§–∏–ª—å—Ç—Ä—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏.

#### –ü—Ä–æ—Å—Ç–æ–π —Ñ–∏–ª—å—Ç—Ä
```yaml
filter:
  workflow: sbd.feature  # –¢–æ–ª—å–∫–æ –¥–ª—è sbd.feature
```

#### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (OR)
```yaml
filter:
  workflow: [sbd.feature, sbd.bugfix]  # feature –ò–õ–ò bugfix
```

#### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (AND)
```yaml
filter:
  workflow: sbd.feature  # –ò
  stage: [designing, implementing]  # –ò
```

#### –í–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
```yaml
filter:
  payload.metadata.priority: high
```

### Wildcard event types

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ wildcards –≤ `event_type`:

```yaml
# –í—Å–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–¥–∞—á–∏
event_type: task.*

# –í—Å–µ —Å–æ–±—ã—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
event_type: quality.*

# –í—Å–µ —Å–æ–±—ã—Ç–∏—è
event_type: "*"
```

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç** (priority) - —á–∏—Å–ª–æ, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–µ–µ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

**–ü—Ä–∞–≤–∏–ª–æ**: –ú–µ–Ω—å—à–µ–µ —á–∏—Å–ª–æ = –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ)

**–î–∏–∞–ø–∞–∑–æ–Ω—ã**:
- **1-10**: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, pre-checks)
- **11-50**: –ü—Ä–µ-–¥–µ–π—Å—Ç–≤–∏—è (quality gates, preconditions, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)
- **51-100**: –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)
- **101-200**: –ü–æ—Å—Ç-–¥–µ–π—Å—Ç–≤–∏—è (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
- **201+**: –ù–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ (cleanup, –∞—Ä—Ö–∏–≤–∞—Ü–∏—è)

**Default**: 100

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º
```yaml
# Priority 5 - –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–µ—Ä–≤—ã–º
- id: sub-validation
  event_type: task.transition_requested
  handler: qa-gates/handlers/validate_transition
  priority: 5

# Priority 50 - –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- id: sub-git
  event_type: task.transition_requested
  handler: git-vcs/handlers/on_transition
  priority: 50
```

#### –î–µ–π—Å—Ç–≤–∏—è ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```yaml
# Priority 20 - —Å–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É
- id: sub-create-branch
  event_type: task.created
  handler: git-vcs/handlers/create_branch
  priority: 20

# Priority 100 - —É–≤–µ–¥–æ–º–∏—Ç—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ—Ç–∫–∏
- id: sub-notify
  event_type: task.created
  handler: notifications/handlers/notify_team
  priority: 100
```

### –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

–ü—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è:
1. –ü–æ `subscription_id` (–ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏)
2. –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –µ—Å–ª–∏ –ø–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω.

---

## –ö–∞—Å–∫–∞–¥—ã —Å–æ–±—ã—Ç–∏–π

### –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–∞—Å–∫–∞–¥?

**–ö–∞—Å–∫–∞–¥** - –∫–æ–≥–¥–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è —ç–º–∏—Ç–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥—Ä—É–≥–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.

```yaml
EVENT.emit("task.created")
  ‚îî‚îÄ> git-vcs.on_task_created()
      ‚îî‚îÄ> VCS.create_branch()
          ‚îî‚îÄ> EVENT.emit("vcs.branch_created")  ‚Üê –ö–∞—Å–∫–∞–¥!
              ‚îî‚îÄ> notifications.on_branch_created()
                  ‚îî‚îÄ> NOTIFIER.send_slack()
```

### Cascade Depth

**cascade_depth** - —É—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞—Å–∫–∞–¥–∞.

- –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ: `cascade_depth = 0`
- –°–æ–±—ã—Ç–∏–µ –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞: `cascade_depth = 1`
- –°–æ–±—ã—Ç–∏–µ –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞: `cascade_depth = 2`
- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ...

**–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞**: 10 —É—Ä–æ–≤–Ω–µ–π

**–ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤**:
```yaml
# –í emit.yml
- if: cascade_depth > 10
  then:
    - error: "Maximum cascade depth exceeded. Possible infinite loop."
```

### Tracking –∫–∞—Å–∫–∞–¥–æ–≤

–ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤ –∫–∞—Å–∫–∞–¥–µ –∑–Ω–∞–µ—Ç –∫—Ç–æ –µ–≥–æ –≤—ã–∑–≤–∞–ª:

```yaml
# –ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
- id: evt-001
  type: task.created
  cascade_depth: 0

# –°–æ–±—ã—Ç–∏–µ –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
- id: evt-002
  type: vcs.branch_created
  payload:
    triggered_by: evt-001  # ‚Üê —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è
  cascade_depth: 1
```

### Best Practices –¥–ª—è –∫–∞—Å–∫–∞–¥–æ–≤

‚úÖ **DO:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—Å–∫–∞–¥—ã –¥–ª—è –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –¥–µ–π—Å—Ç–≤–∏–π
- –≠–º–∏—Ç–∏—Ä—É–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (`vcs.branch_created`, –Ω–µ `task.updated`)
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –≥–ª—É–±–∏–Ω—É –∫–∞—Å–∫–∞–¥–∞ (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ 1-2 —É—Ä–æ–≤–Ω—è)

‚ùå **DON'T:**
- –ò–∑–±–µ–≥–∞–π—Ç–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (A ‚Üí B ‚Üí A)
- –ù–µ —ç–º–∏—Ç–∏—Ä—É–π—Ç–µ –æ–±—â–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (—Ä–∏—Å–∫ —Ü–∏–∫–ª–æ–≤)
- –ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ –∫–∞—Å–∫–∞–¥—ã –≥–ª—É–±–∂–µ 3 —É—Ä–æ–≤–Ω–µ–π

---

## –û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π

#### –í —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
```bash
# –í—Å–µ —Å–æ–±—ã—Ç–∏—è
cat .cm/events/events.yml

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–±—ã—Ç–∏–π
tail -n 100 .cm/events/events.yml

# –°–æ–±—ã—Ç–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏
grep "task_id: FEAT-001" .cm/events/events.yml

# –°–æ–±—ã—Ç–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞
grep "type: task.created" .cm/events/events.yml
```

#### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ –≤ CML
```yaml
# –í—Å–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
- let: recent = EVENT.get_history(limit: 20)
- for: event in recent
  do:
    - info: "[{event.timestamp}] {event.type} ‚Üí {event.handlers_executed.length} handlers"

# –°–æ–±—ã—Ç–∏—è –∑–∞–¥–∞—á–∏
- let: task_events = EVENT.get_history(task_id: "FEAT-001")
- info: "Found {task_events.length} events for FEAT-001"

# –°–æ–±—ã—Ç–∏—è —Ç–∏–ø–∞
- let: created_events = EVENT.get_history(event_type: "task.created", limit: 10)
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–¥–ø–∏—Å–æ–∫

#### –í —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
```bash
# –í—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏
cat .cm/events/subscriptions.yml

# –ü–æ–¥–ø–∏—Å–∫–∏ –ø–∞–∫–µ—Ç–∞
grep "extension: git-vcs" .cm/events/subscriptions.yml

# –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
grep "enabled: false" .cm/events/subscriptions.yml
```

#### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ –≤ CML
```yaml
# –í—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏
- let: all_subs = EVENT.list_subscriptions()
- info: "Total subscriptions: {all_subs.length}"

# –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ
- let: subs = EVENT.list_subscriptions(event_type: "task.created")
- for: sub in subs
  do:
    - info: "  [{sub.priority}] {sub.extension}.{sub.handler}"

# –ü–æ–¥–ø–∏—Å–∫–∏ –ø–∞–∫–µ—Ç–∞
- let: git_subs = EVENT.list_subscriptions(extension: "git-vcs")
```

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```yaml
# –ù–∞–π—Ç–∏ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- let: recent = EVENT.get_history(limit: 100)
- for: event in recent
  do:
    - for: handler in event.handlers_executed
      do:
        - if: handler.duration_ms > 500
          then:
            - warn: "Slow handler: {handler.extension}.{handler.handler} took {handler.duration_ms}ms"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π
- let: all_events = EVENT.get_history(limit: 1000)
- let: stats = group_by(all_events, "type")
- for: [type, events] in stats
  do:
    - info: "{type}: {events.length} events"
```

### –û—Ç–ª–∞–¥–∫–∞ –æ—à–∏–±–æ–∫

```yaml
# –ù–∞–π—Ç–∏ failed handlers
- let: recent = EVENT.get_history(limit: 50)
- for: event in recent
  do:
    - for: handler in event.handlers_executed
      do:
        - if: handler.status == "error"
          then:
            - error: "Handler {handler.handler} failed: {handler.error}"
            - info: "  Event: {event.type} ({event.id})"
            - info: "  Payload: {yaml(event.payload)}"
```

---

## Best Practices

### –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

#### ‚úÖ DO

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π**
```yaml
# Good
- EVENT.emit("task.stage_completed", {stage: "designing"})
- EVENT.emit("vcs.branch_created", {branch: "feature/FEAT-001"})

# Bad
- EVENT.emit("task.updated", {field: "stage"})  # –°–ª–∏—à–∫–æ–º –æ–±—â–µ–µ
```

**–í–∫–ª—é—á–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ payload**
```yaml
# Good
payload:
  task_id: "FEAT-001"
  stage: "designing"
  previous_stage: "creating"
  duration_ms: 45000

# Bad
payload:
  task_id: "FEAT-001"  # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```

**–≠–º–∏—Ç–∏—Ä—É–π—Ç–µ —Å–æ–±—ã—Ç–∏—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö**
```yaml
# Good - events –≤ workflow states
instructions:
  - EVENT.emit("task.stage_started", {stage: "creating"})
  # ... logic ...
  - EVENT.emit("task.stage_completed", {stage: "creating"})

# Bad - events –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
instructions:
  - do_step_1()
  - EVENT.emit("step1.completed")  # –°–ª–∏—à–∫–æ–º –¥–µ—Ç–∞–ª—å–Ω–æ
  - do_step_2()
```

#### ‚ùå DON'T

**–ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–µ —Å–æ–±—ã—Ç–∏—è**
```yaml
# Bad
- EVENT.emit("something.happened", {data: {...}})
- EVENT.emit("task.changed", {task_id: "FEAT-001"})
```

**–ù–µ —ç–º–∏—Ç–∏—Ä—É–π—Ç–µ —Å–æ–±—ã—Ç–∏—è –≤ —Ü–∏–∫–ª–∞—Ö –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã**
```yaml
# Bad
- for: file in files
  do:
    - EVENT.emit("file.processed", {file: file})  # –ë—É–¥–µ—Ç 100 —Å–æ–±—ã—Ç–∏–π!

# Good
- for: file in files
  do:
    - process(file)
- EVENT.emit("files.processed", {count: files.length})  # –û–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ
```

**–ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –±–µ–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤**
```yaml
# Bad - undefined order
- id: sub1
  priority: 100
- id: sub2
  priority: 100  # –ü–æ—Ä—è–¥–æ–∫ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω!

# Good - explicit priorities
- id: sub1
  priority: 50
- id: sub2
  priority: 100
```

### –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

#### ‚úÖ DO

**–î–µ–ª–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ–∫—É—Å–Ω—ã–º–∏**
```yaml
# Good - single responsibility
name: create_git_branch
instructions:
  - VCS.create_branch(payload.task_id, branch_name)

# Bad - multiple responsibilities
name: on_task_created_do_everything
instructions:
  - VCS.create_branch(...)
  - QA.setup_checklist(...)
  - NOTIFIER.send_slack(...)
  # –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π!
```

**–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ preconditions**
```yaml
# Good
instructions:
  - if: !payload.task_id
    then:
      - warn: "No task_id, skipping"
      - return
  
  - let: task = TASK.get(payload.task_id)
  - if: !task
    then:
      - error: "Task {payload.task_id} not found"
      - return
  
  # ... main logic ...
```

**–õ–æ–≥–∏—Ä—É–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è**
```yaml
# Good
instructions:
  - info: "Creating branch for {payload.task_id}"
  - VCS.create_branch(...)
  - TASK.log(payload.task_id, "Branch created: {branch_name}")
  - info: "Branch created successfully"
```

#### ‚ùå DON'T

**–ù–µ –¥–µ–ª–∞–π—Ç–µ –¥–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö**
```yaml
# Bad - blocks execution
instructions:
  - for: i in range(10000)
    do:
      - heavy_computation(i)  # –ë–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–∞ –º–∏–Ω—É—Ç—ã!

# Good - emit event for async processing
instructions:
  - EVENT.emit("heavy.task_queued", {task_id: payload.task_id})
  # Separate worker will process it
```

**–ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏ –º–æ–ª—á–∞**
```yaml
# Bad
instructions:
  - try:
      - risky_operation()
    catch:
      - pass  # –¢–∏—Ö–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É!

# Good
instructions:
  - try:
      - risky_operation()
    catch:
      - error: "Risky operation failed: {error.message}"
      - TASK.log(payload.task_id, "ERROR: {error.message}")
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: Auto-create Git Branch

**–ó–∞–¥–∞—á–∞**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å git –≤–µ—Ç–∫—É.

#### –ü–æ–¥–ø–∏—Å–∫–∞
```yaml
# .cm/events/subscriptions.yml
- id: sub-git-001
  event_type: task.created
  extension: git-vcs
  handler: handlers/auto_branch
  filter:
    workflow: sbd.feature  # –¢–æ–ª—å–∫–æ –¥–ª—è feature tasks
  priority: 20
  enabled: true
```

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫
```yaml
# .cm/packages/git-vcs/handlers/auto_branch.yml
name: auto_branch
description: Automatically create git branch when task is created

params:
  - name: event
  - name: payload

instructions:
  - info: "Git VCS: Creating branch for {payload.task_id}"
  
  # Get task details
  - let: task = TASK.get(payload.task_id)
  
  # Generate branch name
  - let: branch_name = "feature/{task.id}-{slugify(task.title)}"
  
  # Create branch
  - VCS.create_branch(task.id, branch_name)
  
  # Log to task
  - TASK.log(task.id, "Git branch created: {branch_name}")
  
  # Emit cascade event
  - EVENT.emit("vcs.branch_created", {
      task_id: task.id,
      branch: branch_name,
      from_branch: "main",
      triggered_by: event.id
    })
  
  - info: "Branch {branch_name} created successfully"
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ workflow
```yaml
# states/creating.yml
instructions:
  - TASK.create(task_id, workflow_id, title)
  
  # Emit event - git-vcs will automatically create branch
  - EVENT.emit("task.created", {
      task_id: task_id,
      workflow: workflow_id,
      title: title,
      created_by: user_name
    })
```

---

### –ü—Ä–∏–º–µ—Ä 2: Quality Gate Validation

**–ó–∞–¥–∞—á–∞**: –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç–∞–¥–∏—é.

#### –ü–æ–¥–ø–∏—Å–∫–∞
```yaml
# .cm/events/subscriptions.yml
- id: sub-qa-001
  event_type: task.stage_completed
  extension: qa-gates
  handler: handlers/validate_stage
  filter:
    stage: [designing, implementing, verifying]
  priority: 5  # High priority - validate first!
  enabled: true
```

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫
```yaml
# .cm/packages/qa-gates/handlers/validate_stage.yml
name: validate_stage
description: Validate quality gate for completed stage

params:
  - name: event
  - name: payload

instructions:
  - info: "QA Gates: Validating {payload.stage} for {payload.task_id}"
  
  # Get gate definition
  - let: gate = QA_GATE.get_for_stage(payload.stage)
  
  # Run checks
  - let: result = QA_GATE.check(payload.task_id, gate)
  
  # Handle result
  - if: result.passed
    then:
      - TASK.log(payload.task_id, "‚úÖ Quality gate passed for {payload.stage}")
      
      - EVENT.emit("quality.gate_passed", {
          task_id: payload.task_id,
          stage: payload.stage,
          gate_name: gate.name,
          checks: result.checks
        })
    else:
      - TASK.log(payload.task_id, "‚ùå Quality gate failed for {payload.stage}")
      
      - EVENT.emit("quality.gate_failed", {
          task_id: payload.task_id,
          stage: payload.stage,
          gate_name: gate.name,
          errors: result.errors
        })
      
      # Optionally block transition
      - error: "Quality gate failed. Fix issues before proceeding:\n{yaml(result.errors)}"
```

---

### –ü—Ä–∏–º–µ—Ä 3: Team Notifications

**–ó–∞–¥–∞—á–∞**: –£–≤–µ–¥–æ–º–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—É –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö —á–µ—Ä–µ–∑ Slack.

#### Multiple Subscriptions
```yaml
# .cm/events/subscriptions.yml

# Notify on task creation
- id: sub-notify-001
  event_type: task.created
  extension: notifications
  handler: handlers/notify_task_created
  priority: 100
  enabled: true

# Notify on workflow completion
- id: sub-notify-002
  event_type: task.workflow_completed
  extension: notifications
  handler: handlers/notify_task_completed
  filter:
    workflow: sbd.feature
  priority: 100
  enabled: true

# Notify on quality gate failure
- id: sub-notify-003
  event_type: quality.gate_failed
  extension: notifications
  handler: handlers/notify_quality_issue
  priority: 50  # Higher priority - alert immediately
  enabled: true
```

#### Handlers
```yaml
# .cm/packages/notifications/handlers/notify_task_created.yml
name: notify_task_created

params:
  - name: event
  - name: payload

instructions:
  - let: message = "üéØ New task created: {payload.title}\n" +
                   "ID: {payload.task_id}\n" +
                   "Workflow: {payload.workflow}\n" +
                   "By: {payload.created_by}"
  
  - NOTIFIER.send_slack("#dev", message)
  
  - TASK.log(payload.task_id, "Team notified via Slack")
```

```yaml
# .cm/packages/notifications/handlers/notify_quality_issue.yml
name: notify_quality_issue

params:
  - name: event
  - name: payload

instructions:
  - let: message = "‚ö†Ô∏è Quality gate failed!\n" +
                   "Task: {payload.task_id}\n" +
                   "Stage: {payload.stage}\n" +
                   "Gate: {payload.gate_name}\n" +
                   "Errors:\n{format_errors(payload.errors)}"
  
  - NOTIFIER.send_slack("#alerts", message)
  
  - TASK.log(payload.task_id, "Quality issue escalated to team")
```

---

### –ü—Ä–∏–º–µ—Ä 4: Cascading Events

**–ó–∞–¥–∞—á–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π flow: –∑–∞–¥–∞—á–∞ ‚Üí –≤–µ—Ç–∫–∞ ‚Üí –∫–æ–º–º–∏—Ç ‚Üí PR.

```yaml
# Event 1: task.created
EVENT.emit("task.created")
  ‚Üì
  Handler: git-vcs.create_branch
    VCS.create_branch()
    ‚Üì
    # Event 2: vcs.branch_created
    EVENT.emit("vcs.branch_created")
      ‚Üì
      Handler: qa-gates.setup_checklist
        QA_GATE.create_checklist()
        ‚Üì
        # Event 3: quality.checklist_created
        EVENT.emit("quality.checklist_created")
          ‚Üì
          Handler: notifications.notify_ready
            NOTIFIER.send_slack("Task ready for work")
```

**cascade_depth tracking**:
```yaml
evt-001: task.created (depth: 0)
evt-002: vcs.branch_created (depth: 1, triggered_by: evt-001)
evt-003: quality.checklist_created (depth: 2, triggered_by: evt-002)
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π ClearMethod –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

‚úÖ **–°–ª–∞–±—É—é —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å** - –ø–∞–∫–µ—Ç–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã  
‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏  
‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π  
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - —Ñ–∏–ª—å—Ç—Ä—ã, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, –∫–∞—Å–∫–∞–¥—ã  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –∏–∑–æ–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫, –∑–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤  

**–°–º. —Ç–∞–∫–∂–µ:**
- [core.md](core.md) - –ë–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ç—ã —è–¥—Ä–∞
- [extensions.md](extensions.md) - –ö–æ–Ω—Ü–µ–ø—Ç—ã –ø–∞–∫–µ—Ç–æ–≤
- [advanced.md](advanced.md) - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- `packages/basic-events/README.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è BASIC_EVENT
- `packages/basic-events/primer.md` - –ü—Ä–∞–π–º–µ—Ä –¥–ª—è AI –∞–≥–µ–Ω—Ç–æ–≤

