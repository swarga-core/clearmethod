# Концепты ClearMethod

> **Концептуальная модель методологии - как работает система на фундаментальном уровне**

---

## Навигация

- **[Концепты ядра](concepts/core.md)** - AGENT, TASK, WORKFLOW, CONTEXT
- **[Концепты расширений](concepts/extensions.md)** - FILE_TASK, VCS, KANBAN
- **[Продвинутые возможности](concepts/advanced.md)** - Подпроцессы, DSL, события
- **[Архитектурные решения MVP](concepts/mvp-decisions.md)** - Принятые решения

---

## Философия концептов

### Что такое концепт?

**Концепт** в ClearMethod - это аналог класса в ООП, но для ИИ-агента:
- Имеет **свойства** (данные)
- Имеет **методы** (поведение)
- Описывается декларативно в YAML
- Исполняется ИИ-агентом путем интерпретации

**Предмет** (instance) - это воплощенный концепт, аналог объекта в ООП. Например, конкретная задача `TASK-123` - это предмет концепта `TASK`.

### Как это работает?

```
┌──────────────┐
│  Концепт     │  ← Описание в YAML (свойства + методы)
│  (Class)     │
└──────┬───────┘
       │
       │ создает
       ↓
┌──────────────┐
│  Предмет     │  ← Конкретный экземпляр (данные)
│  (Instance)  │
└──────┬───────┘
       │
       │ выполняет
       ↓
┌──────────────┐
│  ИИ-агент    │  ← Читает метод и исполняет шаг за шагом
│  (Executor)  │
└──────────────┘
```

**Ключевое отличие от классического ООП**: Методы не компилируются в машинный код, а описываются на псевдоязыке естественного языка + YAML и интерпретируются ИИ в runtime.

---

## Архитектура концептов

### Двухуровневая модель

```
┌─────────────────────────────────────────────┐
│              ЯДРО (Core)                    │
│  - Минимальный набор концептов              │
│  - Независим от домена                      │
│  - AGENT, TASK, WORKFLOW, CONTEXT           │
└─────────────────────────────────────────────┘
                    ↑
                    │ использует
                    │
┌─────────────────────────────────────────────┐
│          РАСШИРЕНИЯ (Extensions)            │
│  - Доменно-специфичные концепты             │
│  - FILE_TASK, VCS, KANBAN, PRIVACY, ...     │
│  - Опциональны, подключаются по выбору      │
└─────────────────────────────────────────────┘
```

---

## Концепты ядра (краткий обзор)

### 1. AGENT
Представляет ИИ-агента и его контекстное окно. Самоосознание о токенах, модели, ограничениях.

→ **[Подробнее](concepts/core.md#1-agent)**

### 2. TASK
**Абстрактный концепт** - определяет интерфейс для работы с задачами.

Контейнер состояния задачи. Перемещается по workflow, накапливая данные и изменения.

**Ключевые методы**: `create()`, `get_state()`, `set_state()`, `get_property()`, `set_property()`, `log()`

**Реализации**: FILE_TASK (для MVP), DATABASE_TASK (planned), MCP_TASK (planned)

→ **[Подробнее](concepts/core.md#2-task)**

### 3. WORKFLOW
Граф состояний (state machine). Определяет, какие действия выполняются в каждом состоянии.

**Ключевая идея**: Task хранит "Я в состоянии X", Workflow определяет "Состояние X означает делать A, B, C"

**Принцип изоляции**: Состояния не знают друг о друге, координируются через свойства задачи.

→ **[Подробнее](concepts/core.md#3-workflow)**

### 4. CONTEXT
Управление контекстным окном агента. Токены - это валюта, загружаем минимум нужного.

**Методы**: `prime()` - начальная загрузка, `load()` - загрузка сегментов

→ **[Подробнее](concepts/core.md#4-context)**

---

## Концепты расширений (краткий обзор)

### FILE_TASK (для MVP)
**Конкретная реализация TASK** - простое файловое хранилище задач. 

Задачи = папки с файлами (`status.yml`, `specs.md`, `log.md`).

→ **[Подробнее](concepts/extensions.md#file_task-для-mvp)**

### VCS (planned)
Абстракция над системой контроля версий. Один интерфейс для git, hg, svn.

→ **[Подробнее](concepts/extensions.md#vcs-planned-не-для-mvp)**

### KANBAN (planned)
Управление доской задач с колонками. Может быть файловая система или MCP к Jira.

→ **[Подробнее](concepts/extensions.md#kanban-planned-не-для-mvp)**

---

## Продвинутые возможности (краткий обзор)

### Подпроцессы (Sub-workflows)
Переиспользование типовых последовательностей состояний. Как функции в программировании.

→ **[Подробнее](concepts/advanced.md#подпроцессы-sub-workflows)**

### Множественные DSL
Выбор синтаксиса описания методов: YAML-based (MVP), C-like, Natural language.

→ **[Подробнее](concepts/advanced.md#множественные-dsl-domain-specific-languages)**

### Система событий
Реакция на ключевые моменты: `on_state_enter`, `on_task_create`, `on_error`.

→ **[Подробнее](concepts/advanced.md#система-событий-events)**

---

## Типичный сценарий работы

```yaml
# Пользователь создает задачу
User: "/cm-start feature TASK-123"

# Агент загружает контекст и запускает workflow
- do: CONTEXT.prime()
- do: WORKFLOW.start("TASK-123")

# Workflow создает задачу и переходит в первое состояние
- do: FILE_TASK.create("TASK-123", "feature", ...)
- do: FILE_TASK.set_state("TASK-123", "creating")

# Состояние "creating" выполняет свои команды
execute:
  - do: "Request specifications from user"
  - do: "Create specs.md"
  - do: FILE_TASK.set_property("TASK-123", "specs_ready", true)

# Переход к следующему состоянию
User: "/cm-next"
- do: WORKFLOW.next("TASK-123")  # → "designing"

# ... и так далее по всему workflow
```

→ **[Детальный сценарий](concepts/core.md#взаимодействие-концептов-ядра)**

---

## Ключевые принципы

### 1. Декларативность
Описываем **ЧТО** нужно сделать, а не **КАК** (имплементация - задача агента).

### 2. Изоляция состояний
Узлы workflow не знают друг о друге. Координация через свойства задачи.

### 3. Прозрачность
Каждое действие логируется. История доступна и читаема.

### 4. Валидация границ
Pre/post conditions - это контракты. Гарантируют корректность переходов.

### 5. Расширяемость
Ядро минимально. Функциональность добавляется через расширения без изменения ядра.

---

## Архитектурные решения для MVP

Для быстрого старта приняты следующие решения:

| Вопрос | Решение для MVP |
|--------|-----------------|
| Типизация | Мягкая (подсказки) |
| Транзакции | Оптимистичный + логи |
| Параллелизм | Одна задача = один агент |
| Композиция методов | ✅ Полная поддержка |
| Версионирование | Не делаем |
| Guard conditions | В workflow, не в состояниях |
| Абстракции | Core = интерфейсы, Extensions = реализации |
| Хранение задач | FILE_TASK (реализует TASK) |
| Workflow | 6 состояний (+ analyzing) |
| DSL | YAML-based |
| События | ⏸️ Не делаем (planned) |

→ **[Детальное обоснование решений](concepts/mvp-decisions.md)**

---

## Что дальше?

### Для изучения концептов
1. Начните с **[концептов ядра](concepts/core.md)** - фундамент методологии
2. Изучите **[расширения](concepts/extensions.md)** - как добавлять функциональность
3. Ознакомьтесь с **[продвинутыми возможностями](concepts/advanced.md)** - что будет в будущем

### Для реализации MVP
1. Прочитайте **[архитектурные решения](concepts/mvp-decisions.md)** - что и почему выбрано
2. Реализуйте концепты ядра (TASK, WORKFLOW, CONTEXT)
3. Реализуйте FILE_TASK расширение
4. Создайте feature workflow
5. Протестируйте на реальной задаче

---

## Расширяемость

### Как добавить новый концепт?

1. **Определить интерфейс** (свойства + методы)
2. **Создать YAML-спецификации методов**
3. **Указать зависимости** (от каких концептов зависит)
4. **Добавить в расширение**

→ **[Руководство по созданию расширений](concepts/extensions.md#как-создать-свое-расширение)**

---

*Этот документ - навигационный центр. Для детального изучения используйте ссылки на специализированные документы.*
