name: planning
description: "Планирование рефакторинга"

instructions:
  - EVENT.emit("task.stage_started", {task_id: task_id, stage: "planning"})
  - TASK.set_property(task_id, "stage", "planning")
  
  - ask: "Refactoring strategy?"
    into: strategy
  - ask: "Expected improvements?"
    into: improvements
  - ask: "Risks?"
    into: risks
  
  - write: ".cm/tasks/{task_id}/refactoring-plan.md"
    content: |
      # Refactoring Plan
      
      ## Strategy
      {strategy}
      
      ## Expected Improvements
      {improvements}
      
      ## Risks
      {risks}
  
  - TASK.set_property(task_id, "plan_ready", true)
  - TASK.log(task_id, "Refactoring plan created")
  - EVENT.emit("task.stage_completed", {task_id: task_id, stage: "planning"})

postconditions:
  - TASK.get_property(task_id, "plan_ready") == true

