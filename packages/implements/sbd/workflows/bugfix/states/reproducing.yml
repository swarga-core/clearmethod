name: reproducing
description: "–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –±–∞–≥–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ failing —Ç–µ—Å—Ç–∞"

preconditions:
  - TASK.get_property(task_id, "investigation_complete") == true

instructions:
  - group: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞–¥–∏–∏"
    do:
      - EVENT.emit("task.stage_started", {task_id: task_id, stage: "reproducing"})
      - TASK.set_property(task_id, "stage", "reproducing")
      - TASK.log(task_id, "üß™ Started reproduction and test creation")
  
  - group: "–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –±–∞–≥–∞"
    do:
      - info: "Follow reproduction steps to confirm the bug"
      - let: steps = TASK.get_property(task_id, "reproduction_steps")
      - info: "Steps: {steps}"
      
      - ask: "Can you reproduce the bug? (yes/no)"
        into: reproduced
      
      - if: reproduced == "no"
        then:
          - warn: "Cannot reproduce. Need more information."
          - TASK.set_property(task_id, "needs_more_info", true)
          - return
      
      - TASK.set_property(task_id, "bug_reproduced", true)
      - TASK.log(task_id, "Bug successfully reproduced")
  
  - group: "–°–æ–∑–¥–∞–Ω–∏–µ failing —Ç–µ—Å—Ç–∞"
    do:
      - info: "Create a test that demonstrates the bug"
      - ask: "Test file path?"
        into: test_file
      - ask: "Test name?"
        into: test_name
      
      - write: "{test_file}"
        content: |
          # Test for bug {task_id}
          # This test currently FAILS - it will pass after fix
          
          test '{test_name}':
            # Test code here
            pass
      
      - TASK.set_property(task_id, "test_file", test_file)
      - TASK.set_property(task_id, "test_created", true)
      - TASK.log(task_id, "Created failing test: {test_file}")
  
  - group: "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞"
    do:
      - info: "Run the test to confirm it fails"
      - ask: "Does the test fail as expected? (yes/no)"
        into: test_fails
      
      - if: test_fails != "yes"
        then:
          - error: "Test should fail before fix. Please adjust the test."
      
      - TASK.set_property(task_id, "test_verified", true)
      - TASK.log(task_id, "Test verified - fails as expected")
  
  - group: "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–∏"
    do:
      - TASK.set_property(task_id, "reproduction_complete", true)
      - EVENT.emit("task.stage_completed", {task_id: task_id, stage: "reproducing"})
      - info: "‚úÖ Bug reproduced and test created. Ready to fix."

postconditions:
  - TASK.get_property(task_id, "bug_reproduced") == true
  - TASK.get_property(task_id, "test_created") == true

