# State: Completing
# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏

state:
  status: completing
  title: "Completing"
  description: "–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á–∏ –∏ –ø–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤"

# –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è
preconditions:
  - description: "–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞"
    check: "TASK.get_property(task_id, 'verification_passed') == true"
    error_message: "Cannot complete without passing verification"

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
execute:
  # 1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
  - |
    Inform user: "Starting 'Completing' phase.
    Goal: Finalize task and wrap up."

  # 2. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
  - group: "Verify all artifacts are in place"
    do:
      - "Check specs.md exists"
      - "Check analysis.md exists"
      - "Check design.md exists"
      - "Check implementation files exist"
      - "Check test-results.md exists"

  # 3. –°–æ–∑–¥–∞—Ç—å summary.md
  - group: "Create comprehensive summary document"
    do:
      - "Write task summary section (ID, title, completion date)"
      - "Describe what was implemented"
      - "Document key technical decisions"
      - "List all modified and created files"
      - "Reference all artifacts with descriptions"
      - "Add next steps or future improvements if applicable"
      - "Note known limitations if any"
      - "Write summary.md to task folder"

  # 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ task_complete
  - TASK.set_property(task_id, "task_complete", true)

  # 5. –§–∏–Ω–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  - TASK.log(task_id, "Task completed successfully")

  # 6. –ü–æ–∑–¥—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - |
    Congratulate user: "üéâ Task {task_id} completed successfully!

    All artifacts are in task folder: .cm/tasks/{task_id}/

    Summary available in summary.md

    Great work! Ready for the next task?"

# –ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è
postconditions:
  - description: "–§–∞–π–ª summary.md —Å–æ–∑–¥–∞–Ω"
    check: "file_exists(.cm/tasks/{task_id}/summary.md)"
    error_message: "summary.md must be created"

  - description: "–ó–∞–¥–∞—á–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è"
    check: "TASK.get_property(task_id, 'task_complete') == true"
    error_message: "task_complete property must be set"

# –í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
next_states: [] # –≠—Ç–æ –∫–æ–Ω–µ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

# –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–∞
agent_notes: |
  –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ! –í—Ä–µ–º—è –ø—Ä–∞–∑–¥–Ω–æ–≤–∞—Ç—å!

  1. **–ü—Ä–æ–≤–µ—Ä—å**: –í—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ
  2. **–ü–æ–¥–≤–µ–¥–∏ –∏—Ç–æ–≥–∏**: –°–æ–∑–¥–∞–π –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π summary
  3. **–ü–æ–∑–¥—Ä–∞–≤—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Å–ª—É–∂–∏–ª —ç—Ç–æ!
  4. **–ì–æ—Ä–¥–∏—Å—å**: –í—ã –≤–º–µ—Å—Ç–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

  –ü–æ—Å–ª–µ completing:
  - –ù–µ–ª—å–∑—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥ (—ç—Ç–æ –∫–æ–Ω–µ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
  - –ó–∞–¥–∞—á–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π
  - –ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
